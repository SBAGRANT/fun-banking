{{ define "send_money_modal" }}
<div class="flex flex-col gap-4">
  <div>
    <h1 class="text-xl font-extrabold">Send Money</h1>
    <p class="text-gray-600 text-sm">
      You can send money, without approvals, to other customers within this bank. You will not be
      able to send funds that exceed your current account balance.
    </p>
  </div>
  <div id="send-money-form">{{ template "send_money_form" . }}</div>
</div>
{{ end }} {{ define "send_money_form" }}
<form hx-put="/accounts/{{ .Account.ID }}/send-money" class="flex flex-col gap-2">
  <div>
    <label for="name">Recipient</label>
    <input
      hx-get="/banks/{{.Account.Customer.Bank.ID}}/customers"
      hx-trigger="input changed delay:500ms, click, search"
      hx-target="#search-results"
      id="name"
      name="name"
      type="search"
      autocomplete="off"
      onblur="hideSuggestions()"
      class="focus:ring-1 ring-outline"
    />
    <div id="search-results"></div>
    <input id="recipient-field" type="hidden" name="recipient" />
  </div>
  <div>
    <label for="amount">Amount</label>
    <input id="amount" name="amount" type="number" step="0.01" />
  </div>
  <div>
    <label for="description">Description</label>
    <input id="description" name="description" type="text" />
  </div>
  <div class="flex items-center gap-2 mt-2">
    <button
      type="submit"
      class="bg-emerald-700 font-extrabold text-white hover:bg-emerald-800 disabled:bg-gray-200"
    >
      Submit
    </button>
    <button type="reset" class="ghost">Cancel</button>
  </div>
</form>
{{ end }} {{ define "search_bank_customers" }}
<div id="search-suggestions" class="mt-2">
  <strong class="text-sm">Suggestions:</strong>
  <ul class="flex flex-col w-full border rounded-xl mt-2 shadow">
    {{ if gt (len .) 0 }} {{ range . }}
    <li
      class="w-full border-b first:rounded-t-xl last:border-0 last:rounded-b-xl hover:bg-ghost/75"
    >
      <button
        type="button"
        onmousedown="selectRecipient({{ .ID }}, {{ .FullName }})"
        class="text-left w-full py-2 px-3"
      >
        {{ .FullName }}
      </button>
    </li>
    {{ end }} {{ else }}
    <div class="px-3 py-2 text-sm text-gray-600">No results found. Try another search.</div>
    {{ end }}
  </ul>
  <script>
    function hideSuggestions() {
      const searchSuggestions = document.getElementById("search-suggestions");

      if (searchSuggestions) {
        searchSuggestions.style.display = "none";
      }
    }

    function selectRecipient(customerId, fullName) {
      const recipientField = document.getElementById("recipient-field");
      const searchField = document.getElementById("name");

      recipientField.value = customerId;
      searchField.value = fullName;
      hideSuggestions();
    }
  </script>
</div>
{{ end }}
